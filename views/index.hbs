<!-- Герой секция -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="display-5 fw-bold">Найдите исполнителя для любой задачи</h1>
                <p class="lead">Мы готовы помочь вам в решении самых разнообразных задач</p>
                {{#if user}}
                    <a href="/tasks/create" class="btn btn-primary btn-lg">Разместить задание</a>
                {{else}}
                    <a href="/register" class="btn btn-primary btn-lg">Разместить задание</a>
                {{/if}}
            </div>
            <div class="col-md-4 text-center">
                <i class="bi bi-people-fill" style="font-size: 8rem; color: var(--youdo-blue);"></i>
            </div>
        </div>
    </div>
</section>

<!-- Основной контент -->
<div class="container">
  <div class="row">
    <div class="col-12">

  <!-- Типы категорий -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="category-types-nav">
        {{#each typesArray}}
        <button class="btn category-type-btn {{#eq ../selectedType this.name}}active{{/eq}}"
                data-type="{{this.name}}"
                type="button">
          <i class="{{this.icon}} me-2"></i>
          {{this.name}}
        </button>
        {{/each}}
      </div>
    </div>
  </div>

  <!-- Категории выбранного типа -->
  <div class="row">
    <div class="col-12">
      <div class="categories-section">
        <h2 class="section-title">{{selectedType}}</h2>
        <div class="categories-container">
          {{#if categoriesByType}}
            {{#with (lookup categoriesByType selectedType)}}
              {{#if this}}
                {{#each this}}
                <div class="category-item">
                  <a href="/tasks/category/{{this.slug}}" class="category-link">
                    <i class="fas fa-chevron-right category-arrow"></i>
                    <span class="category-name">{{this.name}}</span>
                  </a>
                </div>
                {{/each}}
              {{else}}
                <div class="category-item">
                  <p class="text-muted">В этом разделе пока нет категорий</p>
                </div>
              {{/if}}
            {{else}}
              <div class="category-item">
                <p class="text-muted">Тип категорий не найден</p>
              </div>
            {{/with}}
          {{else}}
            <div class="category-item">
              <p class="text-muted">Данные категорий недоступны</p>
            </div>
          {{/if}}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Информационная секция о сервисе -->
<section class="py-5 mt-5" style="background-color: #f8f9fa;">
    <div class="container">
        <div class="row mb-5">
            <div class="col-12 text-center">
                <h2 class="display-6 fw-bold mb-3">Работа и подработка в Крыму</h2>
                <p class="lead text-muted">Найдите исполнителя или задание бесплатно! <br />Ваш надёжный сервис "Все Решу" для поиска работы и исполнителей в Крыму</p>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-12">
                <div class="card task-card">
                    <div class="card-body p-4">
                        <p class="card-text mb-3">
                            Ищете способ быстро найти работу или подработку в <strong>Симферополе, Севастополе, Ялте, Керчи, Евпатории</strong> или другом городе Крыма? 
                            Хотите найти ответственного исполнителя для задач по дому, ремонту, написанию текстов или ведению соцсетей? Вы пришли по адресу!
                        </p>
                        <p class="card-text mb-0">
                            Наш сайт <strong>"Все Решу"</strong> — это современная бесплатная площадка, где встречаются заказчики и исполнители по всему Крыму. 
                            Мы создали удобный сервис, чтобы вы могли легко найти работу или найти исполнителя для любых задач.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-5">
            <!-- Для исполнителей -->
            <div class="col-md-6 mb-4">
                <div class="card task-card h-100">
                    <div class="card-header bg-light">
                        <h3 class="h4 mb-0">
                            <i class="bi bi-briefcase-fill me-2" style="color: var(--youdo-blue);"></i>
                            Для тех, кто ищет работу и подработку
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="card-text fw-semibold mb-3">Актуальные вакансии и разовые задания в вашем городе.</p>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="bi bi-check-circle-fill me-2" style="color: var(--youdo-blue);"></i>
                                <strong>Работа в Крыму для всех специальностей:</strong> от строителя и курьера до дизайнера и программиста.
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check-circle-fill me-2" style="color: var(--youdo-blue);"></i>
                                Удобный поиск проектов по категориям и городу.
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check-circle-fill me-2" style="color: var(--youdo-blue);"></i>
                                Прямой контакт с заказчиком — договаривайтесь о цене и сроках без посредников.
                            </li>
                            <li class="mb-0">
                                <i class="bi bi-check-circle-fill me-2" style="color: var(--youdo-blue);"></i>
                                Зарабатывайте на своих навыках, выполняя задачи удалённо или лично.
                            </li>
                        </ul>
                        <div class="mt-3">
                            <a href="/tasks" class="btn btn-primary">
                                <i class="bi bi-search me-1"></i>Найти работу сейчас
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Для заказчиков -->
            <div class="col-md-6 mb-4">
                <div class="card task-card h-100">
                    <div class="card-header bg-light">
                        <h3 class="h4 mb-0">
                            <i class="bi bi-people-fill me-2" style="color: var(--youdo-blue);"></i>
                            Для тех, кто ищет исполнителей
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="card-text fw-semibold mb-3">Разместите задание бесплатно и быстро найдите надежного помощника.</p>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="bi bi-check-circle-fill me-2" style="color: var(--youdo-blue);"></i>
                                <strong>Исполнители для любых задач:</strong> ремонт, уборка, перевод, создание сайтов, репетиторство и многое другое.
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check-circle-fill me-2" style="color: var(--youdo-blue);"></i>
                                Широкий выбор кандидатов из всех крупных городов Крыма.
                            </li>
                            <li class="mb-2">
                                <i class="bi bi-check-circle-fill me-2" style="color: var(--youdo-blue);"></i>
                                Экономьте время и деньги, находя специалистов напрямую.
                            </li>
                            <li class="mb-0">
                                <i class="bi bi-check-circle-fill me-2" style="color: var(--youdo-blue);"></i>
                                Выбирайте лучших по отзывам, рейтингу и портфолио.
                            </li>
                        </ul>
                        <div class="mt-3">
                            {{#if user}}
                                <a href="/tasks/create" class="btn btn-primary">
                                    <i class="bi bi-plus-circle me-1"></i>Разместить задание
                                </a>
                            {{else}}
                                <a href="/register" class="btn btn-primary">
                                    <i class="bi bi-plus-circle me-1"></i>Разместить задание
                                </a>
                            {{/if}}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Почему выбирают -->
        <div class="row">
            <div class="col-12">
                <div class="card task-card">
                    <div class="card-header bg-light text-center">
                        <h3 class="h4 mb-0">
                            <i class="bi bi-star-fill me-2" style="color: var(--youdo-blue);"></i>
                            Почему выбирают наш сервис работы в Крыму?
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-start">
                                    <i class="bi bi-piggy-bank-fill me-3 mt-1" style="color: var(--youdo-blue); font-size: 1.5rem;"></i>
                                    <div>
                                        <h5 class="fw-bold mb-2">Полностью бесплатно</h5>
                                        <p class="text-muted mb-0">Никаких скрытых комиссий за размещение или отклик.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-start">
                                    <i class="bi bi-geo-alt-fill me-3 mt-1" style="color: var(--youdo-blue); font-size: 1.5rem;"></i>
                                    <div>
                                        <h5 class="fw-bold mb-2">Фокус на Крым</h5>
                                        <p class="text-muted mb-0">Мы понимаем локальный рынок труда и помогаем именно вам.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-start">
                                    <i class="bi bi-lightning-fill me-3 mt-1" style="color: var(--youdo-blue); font-size: 1.5rem;"></i>
                                    <div>
                                        <h5 class="fw-bold mb-2">Простота и удобство</h5>
                                        <p class="text-muted mb-0">Интуитивно понятный интерфейс для быстрого поиска.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="d-flex align-items-start">
                                    <i class="bi bi-shield-fill-check me-3 mt-1" style="color: var(--youdo-blue); font-size: 1.5rem;"></i>
                                    <div>
                                        <h5 class="fw-bold mb-2">Безопасность и отзывы</h5>
                                        <p class="text-muted mb-0">Система рейтингов помогает сделать правильный выбор.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <p class="lead mb-3">
                                <strong>Присоединяйтесь к нашему сообществу!</strong> Начните искать работу или исполнителей прямо сейчас.
                            </p>
                            {{#if user}}
                                <a href="/tasks" class="btn btn-primary btn-lg me-2">
                                    <i class="bi bi-search me-1"></i>Найти задания
                                </a>
                                <a href="/tasks/create" class="btn btn-outline-primary btn-lg">
                                    <i class="bi bi-plus-circle me-1"></i>Разместить задание
                                </a>
                            {{else}}
                                <a href="/register" class="btn btn-primary btn-lg">
                                    <i class="bi bi-person-plus me-1"></i>Присоединиться сейчас
                                </a>
                            {{/if}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const typeButtons = document.querySelectorAll('.category-type-btn');
  const categoriesSection = document.querySelector('.categories-section');

  // Инициализируем активную кнопку по умолчанию
  const defaultType = 'Курьерские услуги';
  const defaultButton = document.querySelector(`[data-type="${defaultType}"]`);
  if (defaultButton) {
    defaultButton.classList.add('active');
  }

  typeButtons.forEach(button => {
    button.addEventListener('click', function() {
      const type = this.getAttribute('data-type');

      // Убираем активный класс у всех кнопок
      typeButtons.forEach(btn => btn.classList.remove('active'));

      // Добавляем активный класс текущей кнопке
      this.classList.add('active');

      // Здесь будет AJAX запрос для загрузки категорий
      loadCategories(type);
    });
  });

  function loadCategories(type) {
    fetch(`/categories-by-type?type=${encodeURIComponent(type)}`)
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          updateCategoriesSection(data.categories, type);
        } else {
          console.error('Ошибка сервера:', data.error);
        }
      })
      .catch(error => {
        console.error('Ошибка загрузки категорий:', error);
      });
  }

  function updateCategoriesSection(categories, type) {
    const sectionTitle = categoriesSection.querySelector('.section-title');
    const categoriesContainer = categoriesSection.querySelector('.categories-container');

    if (categories.length > 0) {
      sectionTitle.textContent = type;
      categoriesContainer.innerHTML = categories.map(category => `
        <div class="category-item">
          <a href="/tasks/category/${category.slug}" class="category-link">
            <i class="fas fa-chevron-right category-arrow"></i>
            <span class="category-name">${category.name}</span>
          </a>
        </div>
      `).join('');
    } else {
      sectionTitle.textContent = type;
      categoriesContainer.innerHTML = '<p class="text-muted">В этом разделе пока нет категорий</p>';
    }
  }
});
</script>