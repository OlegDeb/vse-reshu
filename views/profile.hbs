<div class="container">
    <div class="row">
        <!-- Левая колонка: информация о пользователе -->
        <div class="col-lg-3">
            <div class="card task-card mb-4">
                <div class="card-body">
                    <!-- Аватар -->
                    <div class="text-center mb-4">
                        {{#if user.avatar}}
                            <img src="{{user.avatar}}" alt="Аватар" class="rounded mb-3" style="width: 200px; height: 200px; object-fit: cover; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        {{else}}
                            <div class="rounded d-flex align-items-center justify-content-center mb-3" style="width: 200px; height: 200px; background-color: var(--youdo-light-blue); box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 0 auto;">
                                <i class="bi bi-person-fill" style="font-size: 100px; color: var(--youdo-blue);"></i>
                            </div>
                        {{/if}}
                    </div>
                    
                    <!-- Основная информация -->
                    {{#if user.firstName}}
                    <p><strong>Имя:</strong> {{user.firstName}}</p>
                    {{/if}}
                    {{#if user.lastName}}
                    <p><strong>Фамилия:</strong> {{user.lastName}}</p>
                    {{/if}}
                    <p><strong>Логин:</strong> {{user.username}}</p>
                    <p><strong>Email:</strong> {{user.email}}</p>
                    
                    <hr>
                    
                    <!-- Дополнительная информация -->
                    {{#if user.phone}}
                    <p><strong>Телефон:</strong> {{user.phone}}</p>
                    {{/if}}

                    {{#if user.dateOfBirth}}
                    <p><strong>Возраст:</strong> {{calculateAge user.dateOfBirth}}</p>
                    {{/if}}

                    {{#if user.gender}}
                    <p><strong>Пол:</strong> {{user.gender}}</p>
                    {{/if}}

                    <p><strong>Дата регистрации:</strong><br>
                        <small class="text-muted">{{user.createdAtFormatted}}</small>
                    </p>

                    {{#if user.lastLogin}}
                    <p><strong>Последний вход:</strong> {{formatDate user.lastLogin}}</p>
                    {{/if}}

                    {{#if user.updatedAt}}
                    <p><strong>Последнее обновление:</strong> {{formatDate user.updatedAt}}</p>
                    {{/if}}
                    
                    <hr>
                    
                    <div class="d-grid gap-2">
                        <a href="/profile/edit" class="btn btn-outline-secondary">
                            <i class="bi bi-pencil me-1"></i>Редактировать профиль
                        </a>
                        <a href="/tasks/create" class="btn btn-primary">
                            <i class="bi bi-plus-circle me-1"></i>Создать задание
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Правая колонка: меню с вкладками и контент -->
        <div class="col-lg-9">
            <!-- Меню вкладок -->
            <ul class="nav nav-tabs mb-4" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link {{#unless (eq activeTab 'tasks')}}active{{/unless}}" id="info-tab" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab" aria-controls="info" aria-selected="true">
                        <i class="bi bi-info-circle me-1"></i>Информация
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link {{#if (eq activeTab 'tasks')}}active{{/if}}" id="tasks-tab" data-bs-toggle="tab" data-bs-target="#tasks" type="button" role="tab" aria-controls="tasks" aria-selected="false">
                        <i class="bi bi-list-task me-1"></i>Мои задания
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="services-tab" data-bs-toggle="tab" data-bs-target="#services" type="button" role="tab" aria-controls="services" aria-selected="false" disabled>
                        <i class="bi bi-briefcase me-1"></i>Услуги
                    </button>
                </li>
            </ul>

            <!-- Контент вкладок -->
            <div class="tab-content" id="profileTabContent">
                <!-- Вкладка: Информация -->
                <div class="tab-pane fade {{#unless (eq activeTab 'tasks')}}show active{{/unless}}" id="info" role="tabpanel" aria-labelledby="info-tab">
                    <div class="card task-card mb-4">
                        <div class="card-body">
                            <h4 class="mb-4"><i class="bi bi-info-circle me-2"></i>О себе</h4>
                            {{#if user.bio}}
                                <div class="mb-4">
                                    <p class="text-muted" style="white-space: pre-wrap; line-height: 1.6;">{{user.bio}}</p>
                                </div>
                            {{else}}
                                <p class="text-muted mb-4">Информация о себе не указана. <a href="/profile/edit">Добавить информацию о себе</a></p>
                            {{/if}}
                        </div>
                    </div>

                    <!-- Дашборд со статистикой -->
                    <div class="card task-card">
                        <div class="card-body">
                            <h4 class="mb-4"><i class="bi bi-bar-chart me-2"></i>Статистика</h4>
                            
                            <!-- Статистика по задачам (где пользователь заказчик) -->
                            <div class="mb-4">
                                <h5 class="mb-3"><i class="bi bi-briefcase me-2"></i>Мои задачи</h5>
                                <div class="row g-3">
                                    <div class="col-md-3 col-sm-6">
                                        <div class="stat-card stat-card-primary">
                                            <div class="stat-icon">
                                                <i class="bi bi-list-task"></i>
                                            </div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{stats.tasksAsAuthor.total}}</div>
                                                <div class="stat-label">Всего создано</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-sm-6">
                                        <div class="stat-card stat-card-info">
                                            <div class="stat-icon">
                                                <i class="bi bi-circle"></i>
                                            </div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{stats.tasksAsAuthor.open}}</div>
                                                <div class="stat-label">Открытых</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-sm-6">
                                        <div class="stat-card stat-card-warning">
                                            <div class="stat-icon">
                                                <i class="bi bi-arrow-repeat"></i>
                                            </div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{stats.tasksAsAuthor.inProgress}}</div>
                                                <div class="stat-label">В работе</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-sm-6">
                                        <div class="stat-card stat-card-success">
                                            <div class="stat-icon">
                                                <i class="bi bi-check-circle"></i>
                                            </div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{stats.tasksAsAuthor.closed}}</div>
                                                <div class="stat-label">Выполнено</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr>

                            <!-- Статистика по исполнению -->
                            <div class="mb-4">
                                <h5 class="mb-3"><i class="bi bi-person-check me-2"></i>Как исполнитель</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="stat-card stat-card-secondary">
                                            <div class="stat-icon">
                                                <i class="bi bi-person-workspace"></i>
                                            </div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{stats.tasksAsExecutor}}</div>
                                                <div class="stat-label">Выполняю задач</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="stat-card stat-card-info">
                                            <div class="stat-icon">
                                                <i class="bi bi-chat-dots"></i>
                                            </div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{stats.responses.total}}</div>
                                                <div class="stat-label">Всего откликов</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr>

                            <!-- Статистика по откликам -->
                            <div>
                                <h5 class="mb-3"><i class="bi bi-reply me-2"></i>Статус откликов</h5>
                                <div class="row g-3">
                                    <div class="col-md-4 col-sm-6">
                                        <div class="stat-card stat-card-success">
                                            <div class="stat-icon">
                                                <i class="bi bi-check-circle-fill"></i>
                                            </div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{stats.responses.accepted}}</div>
                                                <div class="stat-label">Принято</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-6">
                                        <div class="stat-card stat-card-warning">
                                            <div class="stat-icon">
                                                <i class="bi bi-clock-history"></i>
                                            </div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{stats.responses.pending}}</div>
                                                <div class="stat-label">На рассмотрении</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 col-sm-6">
                                        <div class="stat-card stat-card-danger">
                                            <div class="stat-icon">
                                                <i class="bi bi-x-circle"></i>
                                            </div>
                                            <div class="stat-content">
                                                <div class="stat-value">{{stats.responses.rejected}}</div>
                                                <div class="stat-label">Отклонено</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Вкладка: Мои задания -->
                <div class="tab-pane fade {{#if (eq activeTab 'tasks')}}show active{{/if}}" id="tasks" role="tabpanel" aria-labelledby="tasks-tab">
                    {{#if tasks.length}}
                        {{#each tasks}}
                        <div class="card task-card mb-3">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <h5 class="card-title">{{title}}</h5>
                                        <p class="card-text">{{description}}</p>
                                        <div class="mb-2">
                                            <span class="task-category">
                                                <i class="{{category.icon}} me-1"></i>{{category.name}}
                                            </span>
                                            {{#if (eq status 'in_progress')}}
                                                <span class="stats-badge ms-2">В работе</span>
                                            {{else if (eq status 'closed')}}
                                                <span class="badge bg-secondary ms-2">Закрыта</span>
                                            {{/if}}
                                        </div>
                                        <div class="task-location">
                                            <i class="bi bi-geo-alt me-1"></i>
                                            {{#if location}}{{location}}{{else}}Местоположение не указано{{/if}}
                                        </div>
                                    </div>
                                    <div class="col-md-4 text-md-end">
                                        {{#if price}}
                                        <div class="task-price mb-2">{{price}} ₽</div>
                                        {{/if}}
                                        <div class="task-date mb-3">{{createdAtFormatted}}</div>
                                        <a href="/tasks/{{_id}}" class="btn btn-primary">Просмотреть</a>
                                        {{#if (eq ../user._id author._id)}}
                                            {{#if (eq status 'open')}}
                                                <div class="mt-2">
                                                    <a href="/tasks/{{_id}}/edit" class="btn btn-outline-secondary btn-sm">Редактировать</a>
                                                </div>
                                            {{/if}}
                                        {{/if}}
                                        {{#if (eq status 'in_progress')}}
                                            {{#if (eq ../user._id author._id)}}
                                                <div class="mt-2">
                                                    <form action="/tasks/{{_id}}/close" method="POST" class="d-inline">
                                                        <button type="submit" class="btn btn-success btn-sm w-100">
                                                            <i class="bi bi-check-circle me-1"></i>Закрыть задачу
                                                        </button>
                                                    </form>
                                                </div>
                                            {{/if}}
                                        {{/if}}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {{/each}}

                        {{#if user}}
                        <div class="d-flex justify-content-end mb-4">
                            <a href="/tasks/create" class="btn btn-primary">
                                <i class="bi bi-plus-circle me-1"></i>Разместить задание
                            </a>
                        </div>
                        {{/if}}

                        <!-- Пагинация -->
                        {{#if (gt totalPages 1)}}
                        <nav aria-label="Пагинация задач" class="mt-4">
                            <ul class="pagination justify-content-center">
                                {{#if hasPrev}}
                                    <li class="page-item">
                                        <a class="page-link" href="/profile?tab=tasks&page={{subtract currentPage 1}}">Назад</a>
                                    </li>
                                {{else}}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Назад</a>
                                    </li>
                                {{/if}}

                                {{#each pages}}
                                    <li class="page-item {{#if (eq this ../currentPage)}}active{{/if}}">
                                        <a class="page-link" href="/profile?tab=tasks&page={{this}}">{{this}}</a>
                                    </li>
                                {{/each}}

                                {{#if hasNext}}
                                    <li class="page-item">
                                        <a class="page-link" href="/profile?tab=tasks&page={{add currentPage 1}}">Вперед</a>
                                    </li>
                                {{else}}
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Вперед</a>
                                    </li>
                                {{/if}}
                            </ul>
                        </nav>
                        {{/if}}
                    {{else}}
                        <div class="text-center mt-5">
                            <h3>Задач пока нет</h3>
                            {{#if user}}
                                <p>Будьте первым, кто создаст задачу!</p>
                                <a href="/tasks/create" class="btn btn-primary">
                                    <i class="bi bi-plus-circle me-1"></i>Создать задачу
                                </a>
                            {{else}}
                                <p>Зарегистрируйтесь, чтобы создать задачу!</p>
                                <a href="/register" class="btn btn-primary">Регистрация</a>
                            {{/if}}
                        </div>
                    {{/if}}
                </div>

                <!-- Вкладка: Услуги (заглушка) -->
                <div class="tab-pane fade" id="services" role="tabpanel" aria-labelledby="services-tab">
                    <div class="card task-card">
                        <div class="card-body">
                            <h4 class="mb-4"><i class="bi bi-briefcase me-2"></i>Услуги</h4>
                            <p class="text-muted">Раздел услуг будет добавлен позже.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>