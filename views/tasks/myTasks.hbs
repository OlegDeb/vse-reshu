<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>–ú–æ–∏ –∑–∞–¥–∞—á–∏</h1>
  <div>
    <a href="/tasks/create" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</a>
    <a href="/tasks" class="btn btn-secondary">–í—Å–µ –∑–∞–¥–∞—á–∏</a>
  </div>
</div>

{{#if tasks.length}}
  <div class="row">
    {{#each tasks}}
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100 {{#if (eq status 'in_progress')}}border-warning{{else if (eq status 'closed')}}border-secondary{{/if}}">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <i class="{{category.icon}} me-2"></i>
              <span class="badge bg-secondary me-2">{{category.name}}</span>
              <span class="badge {{#if (eq status 'open')}}bg-success{{else if (eq status 'in_progress')}}bg-warning{{else}}bg-secondary{{/if}}">
                {{#if (eq status 'open')}}–û—Ç–∫—Ä—ã—Ç–∞{{else if (eq status 'in_progress')}}–í —Ä–∞–±–æ—Ç–µ{{else}}–ó–∞–∫—Ä—ã—Ç–∞{{/if}}
              </span>
            </div>

            <h5 class="card-title">
              <a href="/tasks/{{_id}}" class="text-decoration-none">{{title}}</a>
            </h5>

            <p class="card-text">{{description}}</p>

            <div class="mt-3">
              {{#if (eq ../user._id author._id)}}
                <small class="text-muted">üë§ –í—ã - –∑–∞–∫–∞–∑—á–∏–∫</small>
              {{else if acceptedResponse}}
                {{#if (eq ../user._id acceptedResponse.responder._id)}}
                  <small class="text-muted">üë∑ –í—ã - –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</small>
                {{else}}
                  <small class="text-muted">üë§ –ó–∞–∫–∞–∑—á–∏–∫: {{author.firstName}} {{author.lastName}}</small>
                {{/if}}
              {{/if}}
            </div>

            {{#if acceptedResponse}}
              <div class="mt-2">
                <small class="text-muted">
                  –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:
                  {{#if (eq ../user._id acceptedResponse.responder._id)}}
                    –í—ã
                  {{else}}
                    {{#if acceptedResponse.responder.firstName}}
                      {{acceptedResponse.responder.firstName}} {{acceptedResponse.responder.lastName}}
                    {{else}}
                      {{acceptedResponse.responder.username}}
                    {{/if}}
                  {{/if}}
                </small>
              </div>
            {{/if}}

            <div class="d-flex justify-content-between align-items-center mt-3">
              <small class="text-muted">{{createdAtFormatted}}</small>
              <div class="d-flex gap-1">
                <a href="/tasks/{{_id}}" class="btn btn-outline-primary btn-sm">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a>
                {{#if (eq ../user._id author._id)}}
                  {{#if (eq status 'open')}}
                    <a href="/tasks/{{_id}}/edit" class="btn btn-outline-warning btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                  {{/if}}
                {{/if}}
              </div>
            </div>

            {{#if (eq status 'in_progress')}}
              {{#if (eq ../user._id author._id)}}
                <div class="mt-2">
                  <form action="/tasks/{{_id}}/close" method="POST" class="d-inline">
                    <button type="submit" class="btn btn-success btn-sm w-100">–ó–∞–∫—Ä—ã—Ç—å –∑–∞–¥–∞—á—É</button>
                  </form>
                </div>
              {{/if}}
            {{/if}}
          </div>
        </div>
      </div>
    {{/each}}
  </div>

  <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
  {{#if totalPages}}
    <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º" class="mt-4">
      <ul class="pagination justify-content-center">
        {{#if hasPrev}}
          <li class="page-item">
            <a class="page-link" href="?page={{subtract currentPage 1}}">–ù–∞–∑–∞–¥</a>
          </li>
        {{/if}}

        {{#each pages}}
          <li class="page-item {{#if (eq this ../currentPage)}}active{{/if}}">
            <a class="page-link" href="?page={{this}}">{{this}}</a>
          </li>
        {{/each}}

        {{#if hasNext}}
          <li class="page-item">
            <a class="page-link" href="?page={{add currentPage 1}}">–î–∞–ª–µ–µ</a>
          </li>
        {{/if}}
      </ul>
    </nav>
  {{/if}}

{{else}}
  <div class="text-center text-muted mt-5">
    <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á</h3>
    <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É –∏–ª–∏ –æ—Ç–∫–ª–∏–∫–Ω–∏—Ç–µ—Å—å –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ</p>
    <div class="mt-4">
      <a href="/tasks/create" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</a>
      <a href="/tasks" class="btn btn-secondary">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∑–∞–¥–∞—á–∏</a>
    </div>
  </div>
{{/if}}