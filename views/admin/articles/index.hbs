<div class="admin-nav mb-4">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/admin/articles">Статьи</a></li>
      <li class="breadcrumb-item"><a href="/admin/categories">Категории задач</a></li>
      <li class="breadcrumb-item"><a href="/admin/article-categories">Категории статей</a></li>
    </ol>
  </nav>
</div>

<div class="d-flex justify-content-between align-items-center mb-4 admin-container">
  <div>
    <h2 class="mb-0">Управление статьями</h2>
    <p class="text-muted mb-0">Создание, редактирование и удаление статей</p>
  </div>
  <a href="/admin/articles/create" class="btn btn-create-category btn-lg">
    <i class="fas fa-plus-circle me-2"></i>
    Создать статью
  </a>
</div>

<!-- Фильтры -->
<div class="card mb-4">
  <div class="card-body">
    <form method="GET" action="/admin/articles" class="row g-3">
      <div class="col-md-4">
        <label for="status" class="form-label">Статус</label>
        <select class="form-select" id="status" name="status">
          <option value="">Все статусы</option>
          <option value="draft" {{#if (eq currentStatus "draft")}}selected{{/if}}>Черновик</option>
          <option value="published" {{#if (eq currentStatus "published")}}selected{{/if}}>Опубликовано</option>
        </select>
      </div>
      <div class="col-md-4">
        <label for="category" class="form-label">Категория</label>
        <select class="form-select" id="category" name="category">
          <option value="">Все категории</option>
          {{#each categories}}
          <option value="{{this._id}}" {{#if (eq this._id ../currentCategory)}}selected{{/if}}>{{this.name}}</option>
          {{/each}}
        </select>
      </div>
      <div class="col-md-4 d-flex align-items-end">
        <button type="submit" class="btn btn-primary me-2">
          <i class="fas fa-filter"></i> Применить
        </button>
        <a href="/admin/articles" class="btn btn-outline-secondary">
          <i class="fas fa-times"></i> Сбросить
        </a>
      </div>
    </form>
  </div>
</div>

{{#if articles}}
<div class="table-responsive">
  <table class="table table-hover">
    <thead>
      <tr>
        <th>Изображение</th>
        <th>Название</th>
        <th>Категория</th>
        <th>Статус</th>
        <th>Просмотры</th>
        <th>Дата</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody>
      {{#each articles}}
      <tr>
        <td>
          {{#if this.image}}
          <img src="{{this.image}}" alt="{{this.title}}" class="img-thumbnail" style="width: 80px; height: 60px; object-fit: cover;">
          {{else}}
          <div class="bg-secondary text-white text-center" style="width: 80px; height: 60px; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-image"></i>
          </div>
          {{/if}}
        </td>
        <td><strong>{{this.title}}</strong></td>
        <td>
          <span class="badge bg-secondary">{{this.category.name}}</span>
        </td>
        <td>
          {{#if (eq this.status "published")}}
          <span class="badge bg-success">Опубликовано</span>
          {{else}}
          <span class="badge bg-warning">Черновик</span>
          {{/if}}
        </td>
        <td><span class="badge bg-info">{{this.viewsCount}}</span></td>
        <td><small>{{formatDate this.updatedAt}}</small></td>
        <td>
          <div class="btn-group" role="group">
            <a href="/admin/articles/{{this._id}}/edit" class="btn btn-outline-primary btn-sm">
              <i class="fas fa-edit"></i> Редактировать
            </a>
            <form action="/admin/articles/{{this._id}}/toggle-status" method="POST" style="display: inline;">
              <button type="submit" class="btn btn-outline-secondary btn-sm">
                {{#if (eq this.status "published")}}
                <i class="fas fa-eye-slash"></i> Снять
                {{else}}
                <i class="fas fa-eye"></i> Опубликовать
                {{/if}}
              </button>
            </form>
            <form action="/admin/articles/{{this._id}}/delete" method="POST" style="display: inline;">
              <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('Удалить статью?')">
                <i class="fas fa-trash"></i> Удалить
              </button>
            </form>
          </div>
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
</div>

<!-- Пагинация -->
{{#if (gt totalPages 1)}}
<nav aria-label="Навигация по страницам">
  <ul class="pagination justify-content-center">
    {{#if hasPrevPage}}
    <li class="page-item">
      <a class="page-link" href="/admin/articles?page={{prevPage}}{{#if currentStatus}}&status={{currentStatus}}{{/if}}{{#if currentCategory}}&category={{currentCategory}}{{/if}}">Предыдущая</a>
    </li>
    {{else}}
    <li class="page-item disabled">
      <span class="page-link">Предыдущая</span>
    </li>
    {{/if}}
    
        {{#each pages}}
        <li class="page-item {{#if (eq this ../currentPage)}}active{{/if}}">
          <a class="page-link" href="/admin/articles?page={{this}}{{#if ../currentStatus}}&status={{../currentStatus}}{{/if}}{{#if ../currentCategory}}&category={{../currentCategory}}{{/if}}">{{this}}</a>
        </li>
        {{/each}}
    
    {{#if hasNextPage}}
    <li class="page-item">
      <a class="page-link" href="/admin/articles?page={{nextPage}}{{#if currentStatus}}&status={{currentStatus}}{{/if}}{{#if currentCategory}}&category={{currentCategory}}{{/if}}">Следующая</a>
    </li>
    {{else}}
    <li class="page-item disabled">
      <span class="page-link">Следующая</span>
    </li>
    {{/if}}
  </ul>
</nav>
{{/if}}

{{else}}
<div class="alert alert-info text-center">
  <i class="fas fa-info-circle fa-2x mb-3"></i>
  <h5>Нет статей</h5>
  <p class="mb-0">Создайте первую статью</p>
  <a href="/admin/articles/create" class="btn btn-create-category mt-3">
    <i class="fas fa-plus-circle"></i> Создать статью
  </a>
</div>
{{/if}}
