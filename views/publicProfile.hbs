<div class="container">
    <div class="row">
        <!-- Левая колонка: информация о пользователе -->
        <div class="col-lg-3">
            <div class="card task-card mb-4">
                <div class="card-body">
                    <!-- Аватар -->
                    <div class="text-center mb-4">
                        {{#if profileUser.avatar}}
                            <img src="{{profileUser.avatar}}" alt="Аватар" class="rounded mb-3" style="width: 200px; height: 200px; object-fit: cover; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        {{else}}
                            <div class="rounded d-flex align-items-center justify-content-center mb-3" style="width: 200px; height: 200px; background-color: var(--youdo-light-blue); box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin: 0 auto;">
                                <i class="bi bi-person-fill" style="font-size: 100px; color: var(--youdo-blue);"></i>
                            </div>
                        {{/if}}
                    </div>
                    
                    <!-- Основная информация (без контактных данных) -->
                    {{#if profileUser.firstName}}
                    <p><strong>Имя:</strong> {{profileUser.firstName}}</p>
                    {{/if}}
                    {{#if profileUser.lastName}}
                    <p><strong>Фамилия:</strong> {{profileUser.lastName}}</p>
                    {{/if}}
                    <p><strong>Логин:</strong> {{profileUser.username}}</p>
                    
                    <hr>
                    
                    <!-- Дополнительная информация (без контактных данных) -->
                    {{#if profileUser.dateOfBirth}}
                    <p><strong>Возраст:</strong> {{calculateAge profileUser.dateOfBirth}}</p>
                    {{/if}}

                    {{#if profileUser.gender}}
                    <p><strong>Пол:</strong> {{profileUser.gender}}</p>
                    {{/if}}

                    <p><strong>Дата регистрации:</strong><br>
                        <small class="text-muted">{{profileUser.createdAtFormatted}}</small>
                    </p>

                    {{#if profileUser.averageRating}}
                    <hr>
                    <div class="text-center">
                        <h5 class="mb-2"><i class="bi bi-star-fill me-1 text-warning"></i>Рейтинг</h5>
                        <div class="mb-2">
                            <span class="display-6 fw-bold">{{profileUser.averageRating}}</span>
                            <span class="text-muted">/ 5</span>
                        </div>
                        <div class="mb-2">
                            {{#each (range 1 5)}}
                                {{#if (gte ../profileUser.averageRating this)}}
                                    <span class="text-warning" style="font-size: 1.5rem;">★</span>
                                {{else}}
                                    <span class="text-muted" style="font-size: 1.5rem;">☆</span>
                                {{/if}}
                            {{/each}}
                        </div>
                        <small class="text-muted">на основе {{profileUser.totalRatings}} 
                            {{#if (eq profileUser.totalRatings 1)}}
                                оценки
                            {{else if (lt profileUser.totalRatings 5)}}
                                оценок
                            {{else}}
                                оценок
                            {{/if}}
                        </small>
                    </div>
                    {{/if}}
                </div>
            </div>
        </div>

        <!-- Правая колонка: контент -->
        <div class="col-lg-9">
            <!-- Информация о себе -->
            <div class="card task-card mb-4">
                <div class="card-body">
                    <h4 class="mb-4"><i class="bi bi-info-circle me-2"></i>О себе</h4>
                    {{#if profileUser.bio}}
                        <div class="mb-4">
                            <p class="text-muted" style="white-space: pre-wrap; line-height: 1.6;">{{profileUser.bio}}</p>
                        </div>
                    {{else}}
                        <p class="text-muted mb-4">{{#if isOwner}}Информация о себе не указана. <a href="/profile/edit">Добавить информацию о себе</a>{{else}}Информация о себе не указана.{{/if}}</p>
                    {{/if}}
                </div>
            </div>

            <!-- Дашборд со статистикой -->
            <div class="card task-card">
                <div class="card-body">
                    <h4 class="mb-4"><i class="bi bi-bar-chart me-2"></i>Статистика</h4>
                    
                    <!-- Статистика по задачам (где пользователь заказчик) -->
                    <div class="mb-4">
                        <h5 class="mb-3"><i class="bi bi-briefcase me-2"></i>Мои задачи</h5>
                        <div class="row g-3">
                            <div class="col-md-3 col-sm-6">
                                <div class="stat-card stat-card-primary">
                                    <div class="stat-icon">
                                        <i class="bi bi-list-task"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-value">{{stats.tasksAsAuthor.total}}</div>
                                        <div class="stat-label">Всего создано</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                                <div class="stat-card stat-card-info">
                                    <div class="stat-icon">
                                        <i class="bi bi-circle"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-value">{{stats.tasksAsAuthor.open}}</div>
                                        <div class="stat-label">Открытых</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                                <div class="stat-card stat-card-warning">
                                    <div class="stat-icon">
                                        <i class="bi bi-arrow-repeat"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-value">{{stats.tasksAsAuthor.inProgress}}</div>
                                        <div class="stat-label">В работе</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                                <div class="stat-card stat-card-success">
                                    <div class="stat-icon">
                                        <i class="bi bi-check-circle"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-value">{{stats.tasksAsAuthor.closed}}</div>
                                        <div class="stat-label">Выполнено</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <!-- Статистика по исполнению -->
                    <div class="mb-4">
                        <h5 class="mb-3"><i class="bi bi-person-check me-2"></i>Как исполнитель</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="stat-card stat-card-secondary">
                                    <div class="stat-icon">
                                        <i class="bi bi-person-workspace"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-value">{{stats.tasksAsExecutor}}</div>
                                        <div class="stat-label">Выполняю задач</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="stat-card stat-card-info">
                                    <div class="stat-icon">
                                        <i class="bi bi-chat-dots"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-value">{{stats.responses.total}}</div>
                                        <div class="stat-label">Всего откликов</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <!-- Статистика по откликам -->
                    <div>
                        <h5 class="mb-3"><i class="bi bi-reply me-2"></i>Статус откликов</h5>
                        <div class="row g-3">
                            <div class="col-md-4 col-sm-6">
                                <div class="stat-card stat-card-success">
                                    <div class="stat-icon">
                                        <i class="bi bi-check-circle-fill"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-value">{{stats.responses.accepted}}</div>
                                        <div class="stat-label">Принято</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-6">
                                <div class="stat-card stat-card-warning">
                                    <div class="stat-icon">
                                        <i class="bi bi-clock-history"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-value">{{stats.responses.pending}}</div>
                                        <div class="stat-label">На рассмотрении</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-6">
                                <div class="stat-card stat-card-danger">
                                    <div class="stat-icon">
                                        <i class="bi bi-x-circle"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-value">{{stats.responses.rejected}}</div>
                                        <div class="stat-label">Отклонено</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Отзывы о пользователе -->
            {{#if ratings.length}}
            <div class="card task-card mb-4">
                <div class="card-body">
                    <h4 class="mb-4">
                        <i class="bi bi-star me-2"></i>Отзывы
                        <span class="badge bg-primary ms-2">{{ratings.length}}</span>
                    </h4>
                    
                    {{#each ratings}}
                    <div class="mb-4 pb-4 {{#unless @last}}border-bottom{{/unless}}">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div class="d-flex align-items-center">
                                {{#if rater.avatar}}
                                    <img src="{{rater.avatar}}" alt="{{rater.firstName}} {{rater.lastName}}" 
                                         class="rounded-circle me-3" style="width: 48px; height: 48px; object-fit: cover;">
                                {{else}}
                                    <div class="rounded-circle d-flex align-items-center justify-content-center me-3" 
                                         style="width: 48px; height: 48px; background-color: var(--youdo-light-blue);">
                                        <i class="bi bi-person-fill" style="font-size: 24px; color: var(--youdo-blue);"></i>
                                    </div>
                                {{/if}}
                                <div>
                                    <strong class="d-block">
                                        {{#if rater.firstName}}
                                            {{rater.firstName}} {{rater.lastName}}
                                        {{else}}
                                            {{rater.username}}
                                        {{/if}}
                                    </strong>
                                    <small class="text-muted">
                                        Отзыв по выполненной задаче
                                    </small>
                                </div>
                            </div>
                            <div class="text-end">
                                <div class="rating-display mb-2">
                                    {{#each (range 1 5)}}
                                        {{#if (gte ../rating this)}}
                                            <span class="text-warning" style="font-size: 1.2rem;">★</span>
                                        {{else}}
                                            <span class="text-muted" style="font-size: 1.2rem;">☆</span>
                                        {{/if}}
                                    {{/each}}
                                </div>
                                <small class="text-muted d-block">{{createdAtFormatted}}</small>
                            </div>
                        </div>
                        {{#if comment}}
                            <div class="p-3 bg-light rounded mt-2">
                                <p class="mb-0" style="white-space: pre-wrap; line-height: 1.6;">{{comment}}</p>
                            </div>
                        {{/if}}
                    </div>
                    {{/each}}
                </div>
            </div>
            {{else}}
            <div class="card task-card mb-4">
                <div class="card-body">
                    <h4 class="mb-4">
                        <i class="bi bi-star me-2"></i>Отзывы
                    </h4>
                    <div class="text-center py-4">
                        <i class="bi bi-star" style="font-size: 3rem; color: #ddd;"></i>
                        <p class="text-muted mt-3 mb-0">
                            <i class="bi bi-info-circle me-2"></i>Пока нет отзывов
                        </p>
                    </div>
                </div>
            </div>
            {{/if}}
        </div>
    </div>
</div>
